;;; 4 Lights, max ADC rate 500ksps, 2ksps output
;;;
;;; This is what is used in the 3DOF micron

common-lisp-user> (opt-integer 4 2000 22000 15000 (/ 500000 8) :max_time (/ 2000.0))
interference 4.33d-3, Fs = 62500.00 (interval 16.00 uS), repeat interval 31
Output sample rate 2016.129, ADC rate 500000.00, ADC divisor 20
F = 8064.52, half-interval 1/2F = 0.000062, divisor 620
F = 10080.65, half-interval 1/2F = 0.0000496, divisor 496
F = 16129.03, half-interval 1/2F = 0.000031, divisor 310
F = 20161.29, half-interval 1/2F = 0.0000248, divisor 248
 2016.13 0.01604 (60483.87, 3h 20161.29)
 6048.39 0.00846 (56451.61, 7h 8064.52)
 8064.52 0.00433 (70564.52, 7h 10080.65)
 8064.52 1.00000 ( 8064.52, 1h 8064.52)
10080.65 1.00000 (10080.65, 1h 10080.65)
10080.65 0.00309 (72580.65, 9h 8064.52)
12096.77 0.00106 (112903.23, 7h 16129.03)
12096.77 0.01663 (50403.23, 5h 10080.65)
14112.90 0.03133 (48387.10, 3h 16129.03)
14112.90 0.00071 (110887.10, 11h 10080.65)
16129.03 0.00054 (141129.03, 7h 20161.29)
16129.03 1.00000 (16129.03, 1h 16129.03)
16129.03 0.00050 (16129.03, 2h 8064.52)
18145.16 0.00406 (80645.16, 5h 16129.03)
20161.29 0.00071 (104838.71, 13h 8064.52)
20161.29 1.00000 (20161.29, 1h 20161.29)
20161.29 0.00050 (20161.29, 2h 10080.65)
22177.42 0.03248 (40322.58, 5h 8064.52)
24193.55 0.25064 (24193.55, 3h 8064.52)
24193.55 0.00208 (100806.45, 5h 20161.29)
26209.68 0.00139 (88709.68, 11h 8064.52)
28225.81 0.00158 (90725.81, 9h 10080.65)
30241.94 0.12833 (30241.94, 3h 10080.65)
0.00433429422706056d0
62500
((250000/31 31 4) (312500/31 31 5) (500000/31 31 8) (625000/31 31 10))


;;;; 6 lights, 1 ksps, Fs min = 44k, 100 MHz/20 MHz timebase
;;;
;;; This is what we are using in the 6DOF micron, as of Nov 12.  Measured
;;; cross-coupling is ~10x larger than predicted, except 3->5 which is 2500x
;;; larger than predicted, and 10x larger than all of the other 1-off
;;; couplings.  The 3->5 coupling as nearly as high in the 1-on test, ruling
;;; out IMD effects.

* (opt-integer 6 2000 22000 44000 (/ 500000 8) :max_time (/ 1000.0) :timebase 100000000 :fs_timebase 20000000)

interference 5.00d-4, Fs = 59523.81 (interval 16.80 uS), repeat interval 59
Output sample rate 1008.8781, ADC rate 476190.47, ADC divisor 42
F = 6053.27, half-interval 1/2F = 82.600006 us, divisor 8260
F = 8071.03, half-interval 1/2F = 61.949997 us, divisor 6195
F = 12106.54, half-interval 1/2F = 41.300003 us, divisor 4130
F = 15133.17, half-interval 1/2F = 33.04 us, divisor 3304
F = 20177.56, half-interval 1/2F = 24.78 us, divisor 2478
F = 21186.44, half-interval 1/2F = 23.6 us, divisor 2360
 1008.88 0.01600 (60532.69, 3h 20177.56)
 1008.88 0.00960 (60532.69, 5h 12106.54)
 2017.76 0.00040 (121065.38, 15h 8071.03)
 3026.63 0.00012 (181598.06, 15h 12106.54)
 3026.63 0.00020 (181598.06, 9h 20177.56)
 3026.63 0.00844 (56497.18, 7h 8071.03)
 3026.63 0.00007 (175544.79, 29h 6053.27)
 4035.51 0.01382 (63559.32, 3h 21186.44)
 4035.51 0.00037 (115012.11, 19h 6053.27)
 5044.39 0.00008 (233050.85, 11h 21186.44)
 5044.39 0.00732 (54479.42, 9h 6053.27)
 6053.27 1.00000 ( 6053.27, 1h 6053.27)
 7062.15 0.00007 (185633.58, 23h 8071.03)
 7062.15 0.00328 (66585.96, 11h 6053.27)
 8071.03 0.00025 (127118.64, 21h 6053.27)
 8071.03 1.00000 ( 8071.03, 1h 8071.03)
 9079.90 0.00005 (187651.33, 31h 6053.27)
 9079.90 0.00010 (169491.53, 21h 8071.03)
10088.78 0.00091 (108958.84, 9h 12106.54)
11097.66 0.00006 (226997.58, 15h 15133.17)
12106.54 0.00021 (166464.89, 11h 15133.17)
12106.54 1.00000 (12106.54, 1h 12106.54)
12106.54 0.00050 (12106.54, 2h 6053.27)
12106.54 0.00017 (190677.97, 9h 21186.44)
13115.42 0.00309 (72639.23, 9h 8071.03)
13115.42 0.00179 (105932.20, 5h 21186.44)
13115.42 0.00128 (105932.20, 7h 15133.17)
14124.29 0.00041 (133171.91, 11h 12106.54)
14124.29 0.03793 (45399.52, 3h 15133.17)
14124.29 0.00071 (104923.33, 13h 8071.03)
15133.17 1.00000 (15133.17, 1h 15133.17)
15133.17 0.00009 (163438.26, 27h 6053.27)
16142.05 0.00050 (16142.05, 2h 8071.03)
16142.05 0.00492 (75665.86, 5h 15133.17)
16142.05 0.00057 (102905.57, 17h 6053.27)
16142.05 0.00009 (221953.19, 11h 20177.56)
17150.93 0.00047 (136198.55, 9h 15133.17)
17150.93 0.00007 (42372.88, 2h 21186.44)
17150.93 0.01999 (42372.88, 7h 6053.27)
18159.81 0.00024 (137207.43, 17h 8071.03)
18159.81 0.33333 (18159.81, 3h 6053.27)
18159.81 0.00207 (100887.81, 5h 20177.56)
18159.81 0.00011 (196731.23, 13h 15133.17)
19168.68 0.00168 (78692.49, 13h 6053.27)
19168.68 0.00008 (40355.13, 2h 20177.56)
19168.68 0.03240 (40355.13, 5h 8071.03)
20177.56 0.00017 (139225.18, 23h 6053.27)
20177.56 1.00000 (20177.56, 1h 20177.56)
21186.44 1.00000 (21186.44, 1h 21186.44)
21186.44 0.00021 (157384.99, 13h 12106.54)
22195.32 0.00054 (141242.94, 7h 20177.56)
23204.20 0.00005 (201775.63, 25h 8071.03)
23204.20 0.07408 (36319.61, 3h 12106.54)
24213.08 0.00038 (24213.08, 2h 12106.54)
24213.08 0.25003 (24213.08, 3h 8071.03)
24213.08 0.00019 (24213.08, 4h 6053.27)
25221.95 0.00250 (84745.76, 7h 12106.54)
25221.95 0.00016 (153349.48, 19h 8071.03)
27239.71 0.00007 (205811.14, 17h 12106.54)
27239.71 0.00008 (32284.10, 4h 8071.03)
27239.71 0.00012 (151331.72, 25h 6053.27)
28248.59 0.00095 (90799.03, 15h 6053.27)
29257.47 0.00138 (88781.28, 11h 8071.03)
29257.47 0.00019 (30266.34, 2h 15133.17)
29257.47 0.07681 (30266.34, 5h 6053.27)
29257.47 0.00047 (148305.08, 7h 21186.44)
Pairwise interference:
      0      1      2      3      4      5
0: 1.0d+0 
1: 2.5d-4 1.0d+0 
2: 5.0d-4 4.6d-5 1.0d+0 
3: 9.0d-5 1.4d-5 2.1d-4 1.0d+0 
4: 1.7d-4 3.8d-5 4.7d-6 1.6d-5 1.0d+0 
5: 4.1d-5 5.5d-6 2.1d-4 7.9d-6 2.2d-5 1.0d+0 
Partition 1 = (0 1 2), Partition 2 = (3 4 5)

Partition 1: 6053.27 8071.03 12106.54 
Internal infererence:
      0      1      2
0: 1.0d+0 
1: 2.5d-4 1.0d+0 
2: 5.0d-4 4.6d-5 1.0d+0 

Partition 2: 15133.17 20177.56 21186.44 
Internal infererence:
      0      1      2
0: 1.0d+0 
1: 1.6d-5 1.0d+0 
2: 7.9d-6 2.2d-5 1.0d+0 

Between partition interference:
9.0d-5 1.7d-4 4.1d-5 
1.4d-5 3.8d-5 5.5d-6 
2.1d-4 4.7d-6 2.1d-4 
Max beteen paritions: 2.1d-4
5.000264026767811d-4
1250000/21
((2500000/413 59 6) (10000000/1239 59 8) (5000000/413 59 12)
 (6250000/413 59 15) (25000000/1239 59 20) (1250000/59 59 21))


;;; This allows 3.6 us of settling time for the DAQ, which seems nearly
;;; adequate for 1 LSB accuracy according to the typical curves.  The
;;; frequency scheme and interference is identical to the next version (that
;;; has dummy conversions.)  Only the ADC sampling rate is different.
;;; ### Doesn't actually help, makes cross-coupling worse.

* (opt-integer 6 2000 22000 24000 35000 :max_time (/ 1000.0) :timebase 100000000 :fs_timebase 20000000)
interference 9.93d-3, Fs = 34722.22 (interval 28.80 uS), repeat interval 29
Output sample rate 1197.318, ADC rate 277777.78, ADC divisor 72
F = 7183.91, half-interval 1/2F = 69.6 us, divisor 6960
F = 9578.54, half-interval 1/2F = 52.2 us, divisor 5220
F = 10775.86, half-interval 1/2F = 46.4 us, divisor 4640
F = 11973.18, half-interval 1/2F = 41.76 us, divisor 4176
F = 14367.82, half-interval 1/2F = 34.8 us, divisor 3480
F = 17959.77, half-interval 1/2F = 27.84 us, divisor 2784
 1197.32 0.07659 (35919.54, 3h 11973.18)
 1197.32 0.04595 (35919.54, 5h 7183.91)
 2394.64 0.10506 (32327.59, 3h 10775.86)
 2394.64 0.00574 (71839.08, 5h 14367.82)
 2394.64 0.00505 (67049.81, 7h 9578.54)
 3591.95 0.00150 (100574.71, 7h 14367.82)
 4789.27 0.00438 (64655.17, 9h 7183.91)
 5986.59 0.14958 (28735.63, 3h 9578.54)
 5986.59 0.00354 (75431.03, 7h 10775.86)
 7183.91 0.00130 (96982.76, 9h 10775.86)
 7183.91 1.00000 ( 7183.91, 1h 7183.91)
 8381.23 0.04432 (43103.45, 3h 14367.82)
 9578.54 0.00993 (59865.90, 5h 11973.18)
 9578.54 0.00196 (79022.99, 11h 7183.91)
 9578.54 1.00000 ( 9578.54, 1h 9578.54)
10775.86 1.00000 (10775.86, 1h 10775.86)
10775.86 0.00101 (93390.80, 13h 7183.91)
11973.18 1.00000 (11973.18, 1h 11973.18)
13170.50 0.33333 (21551.72, 3h 7183.91)
13170.50 0.01939 (47892.72, 5h 9578.54)
14367.82 0.00294 (89798.85, 5h 17959.77)
14367.82 1.00000 (14367.82, 1h 14367.82)
14367.82 0.00258 (83812.26, 7h 11973.18)
15565.13 0.02269 (53879.31, 3h 17959.77)
15565.13 0.01362 (53879.31, 5h 10775.86)
15565.13 0.01196 (50287.36, 7h 7183.91)
16762.45 1.00000 (17959.77, 1h 17959.77)
16762.45 0.00185 (86206.90, 9h 9578.54)
Pairwise interference:
      0      1      2      3      4      5
0: 1.0d+0 
1: 2.0d-3 1.0d+0 
2: 1.3d-3 1.5d-4 1.0d+0 
3: 4.3d-4 9.9d-3 4.1d-4 1.0d+0 
4: 5.9d-4 5.5d-4 5.8d-4 2.6d-3 1.0d+0 
5: 3.6d-4 1.8d-3 1.3d-4 2.8d-4 2.9d-3 1.0d+0 
Partition 1 = (1 3 4), Partition 2 = (0 2 5)

Partition 1: 9578.54 11973.18 14367.82 
Internal infererence:
      0      1      2
0: 1.0d+0 
1: 9.9d-3 1.0d+0 
2: 5.5d-4 2.6d-3 1.0d+0 

Partition 2: 7183.91 10775.86 17959.77 
Internal infererence:
      0      1      2
0: 1.0d+0 
1: 1.3d-3 1.0d+0 
2: 3.6d-4 1.3d-4 1.0d+0 

Between partition interference:
2.0d-3 1.5d-4 1.8d-3 
4.3d-4 4.1d-4 2.8d-4 
5.9d-4 5.8d-4 2.9d-3 
Max beteen paritions: 2.9d-3
0.009929061422590217d0
312500/9
((625000/87 29 6) (2500000/261 29 8) (312500/29 29 9) (3125000/261 29 10)
 (1250000/87 29 12) (1562500/87 29 15))

;;; :nchans 12 allows for dummy conversion between axes to allow settling
;;; time.  Fewer dummy conversions would also deliver benefit, but the this
;;; doesn't give any less frequency domain interference according to the
;;; model.  It would just reduce the overall ADC rate, allowing more settling
;;; time between every conversion.
;;; ### Doesn't actually help, makes cross-coupling worse.


(opt-integer 6 2000 20000 24000 35000 :max_time (/ 1000.0) :timebase 100000000 :fs_timebase 20000000 :nchans 12)

interference 9.93d-3, Fs = 34722.22 (interval 28.80 uS), repeat interval 29
Output sample rate 1197.318, ADC rate 416666.66, ADC divisor 48
F = 7183.91, half-interval 1/2F = 69.6 us, divisor 6960
F = 9578.54, half-interval 1/2F = 52.2 us, divisor 5220
F = 10775.86, half-interval 1/2F = 46.4 us, divisor 4640
F = 11973.18, half-interval 1/2F = 41.76 us, divisor 4176
F = 14367.82, half-interval 1/2F = 34.8 us, divisor 3480
F = 17959.77, half-interval 1/2F = 27.84 us, divisor 2784
 1197.32 0.07659 (35919.54, 3h 11973.18)
 1197.32 0.04595 (35919.54, 5h 7183.91)
 2394.64 0.10506 (32327.59, 3h 10775.86)
 2394.64 0.00574 (71839.08, 5h 14367.82)
 2394.64 0.00505 (67049.81, 7h 9578.54)
 3591.95 0.00150 (100574.71, 7h 14367.82)
 4789.27 0.00438 (64655.17, 9h 7183.91)
 5986.59 0.14958 (28735.63, 3h 9578.54)
 5986.59 0.00354 (75431.03, 7h 10775.86)
 7183.91 0.00130 (96982.76, 9h 10775.86)
 7183.91 1.00000 ( 7183.91, 1h 7183.91)
 8381.23 0.04432 (43103.45, 3h 14367.82)
 9578.54 0.00993 (59865.90, 5h 11973.18)
 9578.54 0.00196 (79022.99, 11h 7183.91)
 9578.54 1.00000 ( 9578.54, 1h 9578.54)
10775.86 1.00000 (10775.86, 1h 10775.86)
10775.86 0.00101 (93390.80, 13h 7183.91)
11973.18 1.00000 (11973.18, 1h 11973.18)
13170.50 0.33333 (21551.72, 3h 7183.91)
13170.50 0.01939 (47892.72, 5h 9578.54)
14367.82 0.00294 (89798.85, 5h 17959.77)
14367.82 1.00000 (14367.82, 1h 14367.82)
14367.82 0.00258 (83812.26, 7h 11973.18)
15565.13 0.02269 (53879.31, 3h 17959.77)
15565.13 0.01362 (53879.31, 5h 10775.86)
15565.13 0.01196 (50287.36, 7h 7183.91)
16762.45 1.00000 (17959.77, 1h 17959.77)
16762.45 0.00185 (86206.90, 9h 9578.54)

Pairwise interference:
      0      1      2      3      4      5
0: 1.0d+0 
1: 2.0d-3 1.0d+0 
2: 1.3d-3 1.5d-4 1.0d+0 
3: 4.3d-4 9.9d-3 4.1d-4 1.0d+0 
4: 5.9d-4 5.5d-4 5.8d-4 2.6d-3 1.0d+0 
5: 3.6d-4 1.8d-3 1.3d-4 2.8d-4 2.9d-3 1.0d+0 
Partition 1 = (1 3 4), Partition 2 = (0 2 5)

Partition 1: 9578.54 11973.18 14367.82 
Internal infererence:
      0      1      2
0: 1.0d+0 
1: 9.9d-3 1.0d+0 
2: 5.5d-4 2.6d-3 1.0d+0 

Partition 2: 7183.91 10775.86 17959.77 
Internal infererence:
      0      1      2
0: 1.0d+0 
1: 1.3d-3 1.0d+0 
2: 3.6d-4 1.3d-4 1.0d+0 

Between partition interference:
2.0d-3 1.5d-4 1.8d-3 
4.3d-4 4.1d-4 2.8d-4 
5.9d-4 5.8d-4 2.9d-3 
Max beteen paritions: 2.9d-3

0.009929061422590217d0
312500/9
((625000/87 29 6) (2500000/261 29 8) (312500/29 29 9) (3125000/261 29 10)
 (1250000/87 29 12) (1562500/87 29 15))
